<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shadow Duel</title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Start Screen -->
    <div id="start-screen" class="overlay">
      <div class="start-panel">
        <h1>Shadow Duel</h1>
        <div class="bot-preset-control">
          <label for="bot-preset-select">Deck do Bot:</label>
          <select id="bot-preset-select"></select>
          <span id="bot-preset-status" class="bot-preset-status"></span>
        </div>
        <p class="start-sub">
          Monte um deck de atÃ© 30 cartas e duele contra um bot.
        </p>
        <div class="start-actions">
          <button id="btn-start-duel">Duelar</button>
          <button id="btn-bot-arena">Bot Arena</button>
          <button id="btn-replay-dashboard">Replay Analytics</button>
          <button id="btn-deck-builder">Meu Deck</button>
          <button id="btn-toggle-test-mode" class="test-mode-toggle">
            Modo teste: desligado
          </button>
          <button id="btn-toggle-dev-mode" class="dev-mode-toggle">
            Dev Mode: desligado
          </button>
          <button
            id="btn-toggle-replay"
            class="replay-toggle"
            title="Grava suas decisÃµes para anÃ¡lise posterior"
          >
            Gravando: desligado
          </button>
        </div>
        <div
          class="language-toggle"
          id="language-toggle"
          role="group"
          aria-label="Language selection"
        >
          <button type="button" class="lang-toggle-btn" data-lang="en">
            EN
          </button>
          <button type="button" class="lang-toggle-btn" data-lang="pt-br">
            PT-BR
          </button>
        </div>
        <div id="validation-messages" class="validation-messages hidden"></div>
      </div>
    </div>

    <!-- Deck Builder -->
    <div id="deck-builder" class="overlay hidden">
      <div class="deck-panel">
        <div class="deck-header">
          <h2>Meu Deck</h2>
          <span id="deck-count">0 / 30</span>
        </div>
        <p class="deck-hint">Maximo de 3 cÃ³pias por carta.</p>
        <div class="deck-body">
          <div class="deck-left">
            <div id="deck-grid" class="deck-grid"></div>
            <div class="extradeck-section">
              <h3 class="extradeck-title">Extra Deck</h3>
              <span id="extradeck-count">0 / 10</span>
              <div
                id="extradeck-grid"
                class="deck-grid extradeck-grid-builder"
              ></div>
            </div>
            <div class="pool">
              <div class="pool-grid" id="pool-grid"></div>
            </div>
          </div>
          <div class="deck-preview-panel">
            <div class="deck-preview-image" id="deck-preview-image"></div>
            <h3 id="deck-preview-name">Selecione uma carta</h3>
            <div class="deck-preview-stats">
              <span id="deck-preview-atk">ATK: -</span>
              <span id="deck-preview-def">DEF: -</span>
            </div>
            <div id="deck-preview-level">Level: -</div>
            <p id="deck-preview-desc">Descricao aparecera aqui.</p>
          </div>
        </div>
        <div class="deck-footer">
          <div class="deck-footer-left">
            <button id="deck-filter-void" class="deck-filter-btn">Void</button>
            <button id="deck-filter-luminarch" class="deck-filter-btn">
              Luminarch
            </button>
            <button id="deck-filter-shadow-heart" class="deck-filter-btn">
              Shadow-Heart
            </button>
            <button id="deck-filter-no-archetype" class="deck-filter-btn">
              Sem arquÃ©tipo
            </button>
          </div>
          <div class="deck-footer-right">
            <button id="deck-save">Salvar</button>
            <button id="deck-cancel">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bot Arena -->
    <div id="bot-arena-modal" class="overlay hidden">
      <div class="bot-arena-panel">
        <div class="arena-header">
          <h2>Bot Arena</h2>
          <button type="button" class="close-arena" aria-label="Close">
            &times;
          </button>
        </div>
        <div class="arena-body">
          <div class="arena-setup">
            <div class="arena-section">
              <h3>Decks</h3>
              <div class="config-row">
                <label for="arena-deck-seat1">Bot 1 (Player)</label>
                <select id="arena-deck-seat1"></select>
              </div>
              <div class="config-row">
                <label for="arena-deck-seat2">Bot 2 (Opponent)</label>
                <select id="arena-deck-seat2"></select>
              </div>
            </div>
            <div class="arena-section">
              <h3>Config</h3>
              <div class="config-row">
                <label for="arena-num-duels">Numero de duelos</label>
                <select id="arena-num-duels">
                  <option value="1">1</option>
                  <option value="5">5</option>
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="30">30</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>
              </div>
              <div class="config-row">
                <label for="arena-speed">Velocidade</label>
                <select id="arena-speed">
                  <option value="1x">1x</option>
                  <option value="2x">2x</option>
                  <option value="4x">4x</option>
                  <option value="instant">Instant</option>
                </select>
              </div>
              <div class="config-row checkbox">
                <label for="arena-auto-pause">
                  Auto pause em empate/erro
                </label>
                <input type="checkbox" id="arena-auto-pause" />
              </div>
            </div>
          </div>
          <div class="arena-stats">
            <h3>Resultados</h3>
            <div class="stats-grid">
              <div class="stat-box">
                <div class="stat-label">Concluidos</div>
                <div class="stat-value" id="arena-completed">0</div>
              </div>
              <div class="stat-box">
                <div class="stat-label">Status</div>
                <div class="stat-value" id="arena-status">Pronto</div>
              </div>
              <div class="stat-box">
                <div class="stat-label">Vitorias Bot 1</div>
                <div class="stat-value" id="arena-wins-1">0</div>
              </div>
              <div class="stat-box">
                <div class="stat-label">Vitorias Bot 2</div>
                <div class="stat-value" id="arena-wins-2">0</div>
              </div>
              <div class="stat-box">
                <div class="stat-label">Empates</div>
                <div class="stat-value" id="arena-draws">0</div>
              </div>
              <div class="stat-box">
                <div class="stat-label">Media de turnos</div>
                <div class="stat-value" id="arena-avg-turns">-</div>
              </div>
            </div>
            <div class="arena-log" id="arena-log">
              <p class="log-entry">Aguardando inicio...</p>
            </div>
          </div>
        </div>
        <div class="arena-footer">
          <button id="btn-arena-start" class="primary">Iniciar</button>
          <button id="btn-arena-cancel" class="secondary">Cancelar</button>
        </div>
      </div>
    </div>

    <div id="game-container">
      <!-- Bot Area (Top) -->
      <div id="bot-area" class="player-area">
        <div class="player-info">
          <span class="name">Opponent</span>
          <div class="lp-counter">LP: <span id="bot-lp">8000</span></div>
        </div>
        <div class="hand-row">
          <div class="hand-zone" id="bot-hand"></div>
        </div>
        <div class="board-wrapper bot-board">
          <div class="side-dock bot-left-dock">
            <div class="deck-zone" id="bot-deck">Deck</div>
            <div class="graveyard-zone" id="bot-graveyard">GY</div>
          </div>
          <div class="board-core">
            <div
              id="bot-spelltrap"
              class="field-zone spelltrap-row"
              data-label="Spell/Trap"
            ></div>
            <div
              id="bot-field"
              class="field-zone monster-row"
              data-label="Monsters"
            ></div>
          </div>
          <div class="side-dock bot-right-dock">
            <div class="extradeck-zone" id="bot-extradeck">Extra</div>
            <div class="fieldspell-dock">
              <div
                id="bot-fieldspell"
                class="field-slot"
                data-label="Field"
              ></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Center Info / Phase Indicator -->
      <div id="center-info">
        <div id="turn-indicator">Turn: Player</div>
        <ul id="phase-track">
          <li data-phase="draw" class="active">Draw Phase</li>
          <li data-phase="standby">Standby Phase</li>
          <li data-phase="main1">Main Phase 1</li>
          <li data-phase="battle">Battle Phase</li>
          <li data-phase="main2">Main Phase 2</li>
          <li data-phase="end">End Phase</li>
        </ul>
      </div>

      <!-- Player Area (Bottom) -->
      <div id="player-area" class="player-area">
        <div class="board-wrapper player-board">
          <div class="side-dock player-left-dock">
            <div class="fieldspell-dock">
              <div
                id="player-fieldspell"
                class="field-slot"
                data-label="Field"
              ></div>
            </div>
            <div class="extradeck-zone" id="player-extradeck">Extra</div>
          </div>
          <div class="board-core">
            <div
              id="player-field"
              class="field-zone monster-row"
              data-label="Monsters"
            ></div>
            <div
              id="player-spelltrap"
              class="field-zone spelltrap-row"
              data-label="Spell/Trap"
            ></div>
          </div>
          <div class="side-dock player-right-dock">
            <div class="graveyard-zone" id="player-graveyard">GY</div>
            <div class="deck-zone" id="player-deck">Deck</div>
          </div>
        </div>
        <div class="hand-row">
          <div class="hand-zone" id="player-hand"></div>
        </div>
        <div class="player-info">
          <span class="name">You</span>
          <div class="lp-counter">LP: <span id="player-lp">8000</span></div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div id="sidebar">
      <div id="card-preview">
        <div id="preview-image"></div>
        <div id="preview-info">
          <h2 id="preview-name">Hover a card</h2>
          <div id="preview-stats">
            <span id="preview-atk">ATK: -</span>
            <span id="preview-def">DEF: -</span>
          </div>
          <div id="preview-level">Level: -</div>
          <p id="preview-desc">Description will appear here.</p>
        </div>
      </div>
      <!-- Action log temporarily hidden - will be re-added in the future -->
      <!-- <div id="action-log">
        <div class="log-header">
          <span>AÃ§Ãµes</span>
        </div>
        <div id="action-log-list"></div>
      </div> -->
    </div>

    <!-- Graveyard Modal -->
    <div id="gy-modal" class="modal hidden">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>Graveyard</h2>
        <p id="gy-hint" class="gy-hint"></p>
        <div id="gy-grid" class="gy-grid"></div>
      </div>
    </div>

    <!-- Extra Deck Modal -->
    <div id="extradeck-modal" class="modal hidden">
      <div class="modal-content">
        <!-- close button removed; modal closes via overlay click -->
        <h2>Extra Deck</h2>
        <!-- hint removed -->
        <div id="extradeck-modal-grid" class="gy-grid"></div>
      </div>
    </div>

    <!-- Search Modal -->
    <div id="search-modal" class="modal hidden">
      <div class="modal-content search-modal-content">
        <span class="close-modal" id="search-close">&times;</span>
        <h2>Adicionar carta do Deck</h2>
        <p class="search-hint">
          Selecione uma carta do deck ou digite o nome exato para testes.
        </p>
        <div class="search-row">
          <input
            type="text"
            id="search-input"
            placeholder="Digite o nome da carta"
          />
          <select id="search-dropdown"></select>
        </div>
        <div class="search-actions">
          <button id="search-confirm">Adicionar</button>
          <button id="search-cancel" class="secondary">Cancelar</button>
        </div>
      </div>
    </div>

    <script type="module" src="src/main.js"></script>

    <div id="dev-panel" class="dev-panel hidden">
      <h3>Dev Harness</h3>
      <div class="dev-field">
        <label for="dev-draw-player">Comprar cartas</label>
        <div class="dev-inline">
          <select id="dev-draw-player">
            <option value="player">Player</option>
            <option value="bot">Bot</option>
          </select>
          <input type="number" id="dev-draw-count" min="1" max="10" value="1" />
          <button id="dev-draw-btn">Comprar</button>
        </div>
      </div>
      <div class="dev-field">
        <label for="dev-give-name">Adicionar carta</label>
        <input
          type="text"
          id="dev-give-name"
          placeholder="Nome da carta ex.: Infinity Searcher"
        />
        <div class="dev-inline">
          <select id="dev-give-player">
            <option value="player">Player</option>
            <option value="bot">Bot</option>
          </select>
          <select id="dev-give-zone">
            <option value="hand">Hand</option>
            <option value="field-attack">Field (ATK)</option>
            <option value="field-defense">Field (DEF)</option>
            <option value="spellTrap">Spell/Trap</option>
            <option value="fieldSpell">Field Spell</option>
            <option value="graveyard">Graveyard</option>
          </select>
          <button id="dev-give-btn">Adicionar</button>
        </div>
      </div>
      <div class="dev-field">
        <label for="dev-force-phase">ForÃ§ar fase</label>
        <div class="dev-inline">
          <select id="dev-force-phase">
            <option value="draw">Draw</option>
            <option value="standby">Standby</option>
            <option value="main1">Main 1</option>
            <option value="battle">Battle</option>
            <option value="main2">Main 2</option>
            <option value="end">End</option>
          </select>
          <button id="dev-force-phase-btn">ForÃ§ar</button>
        </div>
      </div>
      <div class="dev-field">
        <label for="dev-setup-json">Setup de board (JSON)</label>
        <textarea
          id="dev-setup-json"
          rows="4"
          placeholder='{"player":{"hand":["Infinity Searcher"]}}'
        ></textarea>
        <button id="dev-apply-setup">Aplicar Setup</button>
      </div>
      <div class="dev-field">
        <label>Activation Pipeline Sanity Suite</label>
        <div class="dev-inline">
          <button id="dev-sanity-a">
            Sanity A: Hand spell target + cancel
          </button>
          <button id="dev-sanity-b">Sanity B: placementOnly</button>
          <button id="dev-sanity-c">
            Sanity C: committed field spell fail + restore
          </button>
          <button id="dev-sanity-d">Sanity D: triggered target flow</button>
          <button id="dev-sanity-e">Sanity E: bot auto-select</button>
          <button id="dev-sanity-f">Sanity F: player strategy manual</button>
          <button id="dev-sanity-g">Sanity G: bot min=0 optional</button>
          <button id="dev-sanity-h">
            Sanity H: Hydra Titan before_destroy
          </button>
          <button id="dev-sanity-i">Sanity I: field full protection</button>
          <button id="dev-sanity-j">Sanity J: rollback invariants</button>
          <button id="dev-sanity-k">Sanity K: once per turn</button>
          <button id="dev-sanity-l">Sanity L: action while selecting</button>
          <button id="dev-sanity-m">Sanity M: action while resolving</button>
          <button id="dev-sanity-n">Sanity N: deck empty draw</button>
          <button id="dev-sanity-o">Sanity O: stale target</button>
        </div>
      </div>
      <button id="dev-reset-duel" class="dev-reset-btn">Resetar Duelo</button>
    </div>

    <!-- Replay Dashboard Modal -->
    <div id="replay-dashboard-modal" class="overlay hidden">
      <div class="replay-dashboard-panel">
        <div class="replay-dashboard-header">
          <h2>ðŸ“Š Replay Analytics</h2>
          <button
            type="button"
            class="close-replay-dashboard"
            aria-label="Close"
          >
            &times;
          </button>
        </div>
        <div
          id="replay-dashboard-container"
          class="replay-dashboard-body"
        ></div>
      </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="overlay hidden">
      <div class="game-over-panel">
        <h1 id="game-over-title">Victory!</h1>
        <p id="game-over-message">VocÃª venceu o duelo!</p>
        <div class="game-over-stats">
          <div class="stat-row">
            <span>Seus LP:</span>
            <span id="game-over-player-lp">8000</span>
          </div>
          <div class="stat-row">
            <span>LP do Bot:</span>
            <span id="game-over-bot-lp">0</span>
          </div>
          <div class="stat-row">
            <span>Turnos:</span>
            <span id="game-over-turns">5</span>
          </div>
        </div>
        <div class="game-over-actions">
          <button id="btn-game-over-menu">Menu Principal</button>
          <button id="btn-game-over-rematch">Revanche</button>
          <button
            id="btn-game-over-export"
            class="export-btn"
            title="Exportar replay deste duelo"
          >
            ðŸ“¥ Exportar Replay
          </button>
        </div>
        <p id="game-over-replay-status" class="replay-status hidden"></p>
      </div>
    </div>
  </body>
</html>
